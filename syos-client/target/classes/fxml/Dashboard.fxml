<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>

<VBox spacing="25" styleClass="dashboard-container" 
      xmlns="http://javafx.com/javafx/17" 
      xmlns:fx="http://javafx.com/fxml/1" 
      fx:controller="com.syos.client.presentation.controllers.DashboardController">

    <padding>
        <Insets bottom="30" left="30" right="30" top="30" />
    </padding>

    <!-- 1. Header Section -->
    <HBox alignment="CENTER_LEFT" spacing="20">
        <VBox>
            <Label styleClass="header-text" text="Overview" />
            <Label styleClass="metric-subtitle" text="Welcome back, Admin" />
        </VBox>
        <Region HBox.hgrow="ALWAYS" />
        <Button onAction="#handleRefresh" styleClass="action-button" text="↻ Refresh Data" />
    </HBox>

    <!-- 2. Metrics Cards Row -->
    <HBox spacing="20">
        <!-- Sales Card -->
        <VBox styleClass="metric-card" HBox.hgrow="ALWAYS">
            <Label styleClass="metric-title" text="TODAY'S SALES" />
            <!-- Changed text to LKR -->
            <Label fx:id="todaySalesValue" styleClass="metric-value" text="LKR 0.00" />
            <Label fx:id="todaySalesSubtitle" styleClass="metric-subtitle" text="No sales recorded today" />
        </VBox>

        <!-- Inventory Value Card -->
        <VBox styleClass="metric-card" HBox.hgrow="ALWAYS">
            <Label styleClass="metric-title" text="TOTAL INVENTORY VALUE" />
            <Label fx:id="inventoryValue" styleClass="metric-value" text="LKR 0.00" />
            <HBox spacing="5" alignment="CENTER_LEFT">
                 <Label styleClass="metric-subtitle" text="Total Transactions:" />
                 <Label fx:id="transactionCount" styleClass="metric-subtitle" style="-fx-font-weight:bold;" text="0" />
            </HBox>
        </VBox>

        <!-- Inventory Health Card -->
        <VBox styleClass="metric-card" HBox.hgrow="ALWAYS">
            <Label styleClass="metric-title" text="INVENTORY HEALTH" />
            <HBox spacing="20" alignment="CENTER_LEFT">
                <VBox>
                    <Label fx:id="lowStockValue" styleClass="metric-value-small" text="0" style="-fx-text-fill: #f59e0b;"/>
                    <Label styleClass="metric-subtitle" text="Low Stock" />
                </VBox>
                <Separator orientation="VERTICAL" />
                <VBox>
                    <Label fx:id="expiringSoonValue" styleClass="metric-value-small" text="0" style="-fx-text-fill: #ef4444;"/>
                    <Label styleClass="metric-subtitle" text="Out of Stock" />
                </VBox>
            </HBox>
            <Region VBox.vgrow="ALWAYS" />
            <Button onAction="#handleCheckLowStock" styleClass="text-button" text="View Alerts →" />
        </VBox>
    </HBox>

    <!-- 3. Quick Actions Row -->
    <HBox spacing="15" styleClass="action-bar">
        <Button onAction="#handleNewSale" styleClass="primary-button" text="+ New Sale (POS)" />
        <Button onAction="#handleAddStock" styleClass="secondary-button" text="Add Inventory" />
        <Button onAction="#handleViewReports" styleClass="secondary-button" text="Download Reports" />
    </HBox>

    <!-- 4. Main Content: Chart and Table -->
    <HBox spacing="20" VBox.vgrow="ALWAYS">
        
        <!-- Stock Chart -->
        <VBox styleClass="card" HBox.hgrow="ALWAYS" maxWidth="Infinity">
            <Label styleClass="subheader-text" text="Category Performance" />
            <BarChart fx:id="stockLevelChart" legendVisible="false" verticalGridLinesVisible="false" animated="true">
                <xAxis>
                    <CategoryAxis label="Category" />
                </xAxis>
                <yAxis>
                    <NumberAxis label="Quantity" />
                </yAxis>
            </BarChart>
        </VBox>

        <!-- Recent Transactions Table -->
        <VBox styleClass="card" HBox.hgrow="ALWAYS" maxWidth="Infinity">
            <Label styleClass="subheader-text" text="Recent Transactions" />
            <TableView fx:id="recentTransactionsTable" VBox.vgrow="ALWAYS">
                <columns>
                    <TableColumn fx:id="billIdColumn" text="ID" prefWidth="60"/>
                    <TableColumn fx:id="dateTimeColumn" text="Date" prefWidth="120"/>
                    <TableColumn fx:id="customerColumn" text="Customer" prefWidth="100"/>
                    <TableColumn fx:id="itemsColumn" text="Qty" prefWidth="50"/>
                    <TableColumn fx:id="totalColumn" text="Total (LKR)" prefWidth="100"/>
                    <TableColumn fx:id="paymentColumn" text="Method" prefWidth="80"/>
                </columns>
                <columnResizePolicy>
                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                </columnResizePolicy>
            </TableView>
        </VBox>
    </HBox>

</VBox>